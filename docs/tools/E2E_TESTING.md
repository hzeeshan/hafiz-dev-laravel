# E2E Testing for Tools — Playwright

## Why

With 60+ tools and growing (translations, new tools), manual testing of every button, label, and functionality became a bottleneck. We evaluated [agent-browser](https://github.com/vercel-labs/agent-browser) (Vercel's AI browser automation CLI) but chose **Playwright directly** — agent-browser is a wrapper around Playwright designed for AI agents that dynamically explore pages. Our tools have deterministic, predictable flows, so plain Playwright tests are simpler, faster, and more maintainable.

## How It Works

**Two layers of tests:**

1. **Generic tests** (`e2e/generic/`) — Run for every translated tool automatically. Check SEO meta tags, JSON-LD schemas, page structure (H1, breadcrumbs, FAQ, features), and console errors.

2. **Functional tests** (`e2e/tools/`) — Per-tool tests that verify actual functionality (click buttons, fill inputs, check outputs). Written when a tool gets translated or newly created.

**Both layers run in two locales** — English (`/tools/{slug}`) and Italian (`/it/strumenti/{slug}`) — using Playwright's project feature.

## Coverage Strategy

- **Existing 60 English tools**: No retroactive tests (already stable in production)
- **Translated tools**: Tests auto-generated by the `/translate-tool` skill (Step 7)
- **New tools**: Tests written when a "create tool" skill is built (future)
- Coverage grows organically with every translation or new tool

## File Structure

```
e2e/
├── playwright.config.ts          # Config (EN/IT projects, auto-starts dev server)
├── fixtures/
│   └── tool-page.ts              # ToolPage class with reusable assertions
├── helpers/
│   └── tool-registry.ts          # EN→IT slug mappings (source of truth)
├── generic/
│   └── tool-structure.spec.ts    # SEO, schemas, structure (all translated tools)
└── tools/
    ├── base64-encoder.spec.ts    # Functional tests (Pattern A: Input/Transform/Output)
    └── password-generator.spec.ts # Functional tests (Pattern B: Generator)
```

## Commands

```bash
npm run test:e2e          # All tests, both EN and IT
npm run test:e2e:en       # English only
npm run test:e2e:it       # Italian only
npm run test:e2e:ui       # Interactive UI mode (visual debugger)

# Single tool
npx playwright test --config=e2e/playwright.config.ts -g "base64"

# Watch it in a real browser
npx playwright test --config=e2e/playwright.config.ts --headed -g "base64"
```

Requires dev server on `localhost:8000` (Playwright auto-starts it if not running).

## Adding Tests for a New Tool

The `/translate-tool` skill handles this automatically (Step 7). Manually:

1. Add Italian slug to `e2e/helpers/tool-registry.ts` → `ITALIAN_SLUGS` object
2. Create `e2e/tools/{slug}.spec.ts` — read the script partial to identify interactive elements
3. Run `npx playwright test --config=e2e/playwright.config.ts -g "{slug}"`

## Tool Test Patterns

| Pattern | Example | What to test |
|---------|---------|-------------|
| **Input/Transform/Output** | base64-encoder, json-formatter, converters | Fill input → click action → verify output |
| **Generator** | password-generator, uuid-generator, lorem-ipsum | Click generate → verify output format/length |
| **Real-time** | word-counter, color-converter | Type input → verify stats update immediately |
| **File-based** | image-compressor | Use `page.setInputFiles()` → verify processing |

## Key Design Decisions

- **Playwright over agent-browser**: Deterministic tests don't need AI exploration
- **`e2e/` directory** (not `tests/e2e/`): Keeps browser tests separate from PHPUnit
- **Tool registry as source of truth**: Single file maps EN→IT slugs for routing
- **Generic + functional split**: Generic tests scale automatically; functional tests are per-tool
- **Same IDs in EN and IT**: HTML element IDs are identical across locales (only text differs), so functional tests work for both without modification
